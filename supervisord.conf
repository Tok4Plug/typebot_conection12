[supervisord]
nodaemon=true              ; Railway precisa que fique em foreground
logfile=/dev/stdout
loglevel=info
pidfile=/tmp/supervisord.pid

; ==============================
; üåê Bridge (FastAPI + Uvicorn)
; ==============================
[program:bridge]
command=uvicorn app_bridge:app --host 0.0.0.0 --port 8080 --log-level info
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ==============================
; ü§ñ Bot principal
; ==============================
[program:bot]
command=python bot_gesto/bot.py
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ==============================
; ‚öôÔ∏è Worker - filas, retrofeed e retries
; ==============================
[program:worker]
command=python bot_gesto/worker.py
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ==============================
; üìä Admin Service (monitoramento + m√©tricas Prometheus)
; ==============================
[program:admin]
command=uvicorn bot_gesto.admin_service:app --host 0.0.0.0 --port 8000 --log-level info
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ==============================
; üîÅ Retro-feed (reenviar leads antigos)
; ==============================
[program:retrofeed]
command=python bot_gesto/retrofeed.py
directory=/app
autostart=false        ; inicia manualmente quando precisar
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ==============================
; üî• Warmup (reprocessa leads hist√≥ricos)
; ==============================
[program:warmup]
command=python bot_gesto/tools/warmup.py
directory=/app
autostart=false
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ==============================
; üì¶ DLQ Processor (eventos que falharam)
; ==============================
[program:dlq]
command=python bot_gesto/tools/dlq_processor.py
directory=/app
autostart=false
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ==============================
; ‚è∞ Scheduler (tarefas peri√≥dicas)
; ==============================
[program:scheduler]
command=python bot_gesto/tools/scheduler.py
directory=/app
autostart=false
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr