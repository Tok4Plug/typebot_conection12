; =============================
; supervisord.conf â€” Bridge + BotGestor
; =============================
[supervisord]
loglevel=info
nodaemon=true                 ; fica no primeiro plano (Railway precisa disso)
pidfile=/tmp/supervisord.pid

; ===== Bridge (FastAPI / app_bridge.py) =====
[program:bridge]
; usamos /bin/sh -c para suportar ${PORT} do Railway
command=/bin/sh -c 'uvicorn app_bridge:app --host 0.0.0.0 --port ${PORT:-8080} --log-level info'
directory=/app
autostart=true
autorestart=true
startretries=10
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0
; garante que o BRIDGE_BOT_DIR aponte para a pasta copiada
environment=BRIDGE_BOT_DIR="/app/bot_gesto"

; ===== Bot principal (captura leads / envia eventos) =====
[program:bot]
command=/bin/sh -c 'python -u bot_gesto/bot.py'
directory=/app
autostart=true
autorestart=true
startretries=10
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0

; ===== Worker (filas, retries, retro-feed) =====
[program:worker]
command=/bin/sh -c 'python -u bot_gesto/worker.py'
directory=/app
autostart=true
autorestart=true
startretries=10
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0